var b=["angular-cli","create-react-app","html","javascript","node","polymer","typescript","vue"],E={clickToLoad:function(e){return p("ctl",e)},devToolsHeight:function(e){return j("devToolsHeight",e)},forceEmbedLayout:function(e){return p("embed",e)},hideDevTools:function(e){return p("hideDevTools",e)},hideExplorer:function(e){return p("hideExplorer",e)},hideNavigation:function(e){return p("hideNavigation",e)},showSidebar:function(e){return function(t,n){return typeof n=="boolean"?"showSidebar="+(n?"1":"0"):""}(0,e)},openFile:function(e){return function(t,n){return(Array.isArray(n)?n:[n]).filter(function(r){return typeof r=="string"&&r.trim()!==""}).map(function(r){return"file="+encodeURIComponent(r.trim())})}(0,e).join("&")},terminalHeight:function(e){return j("terminalHeight",e)},theme:function(e){return S("theme",["light","dark"],e)},view:function(e){return S("view",["preview","editor"],e)}};function P(e){e===void 0&&(e={});var t=Object.entries(e).map(function(n){var r=n[0],i=n[1];return i!=null&&E.hasOwnProperty(r)?E[r](i):""}).filter(Boolean);return t.length?"?"+t.join("&"):""}function p(e,t){return t===!0?e+"=1":""}function j(e,t){return typeof t=="number"&&t>=0&&t<=100?e+"="+Math.round(t):""}function S(e,t,n){return typeof n=="string"&&t.includes(n)?e+"="+n:""}function T(){return Math.random().toString(36).slice(2,6)+Math.random().toString(36).slice(2,6)}function v(e,t){return""+O(t)+e+P(t)}function y(e,t){var n={forceEmbedLayout:!0};return t&&typeof t=="object"&&Object.assign(n,t),""+O(n)+e+P(n)}function O(e){return e===void 0&&(e={}),typeof e.origin=="string"?e.origin:"https://stackblitz.com"}function g(e,t,n){if(!t||!e||!e.parentNode)throw new Error("Invalid Element");e.id&&(t.id=e.id),e.className&&(t.className=e.className),function(r,i){i&&typeof i=="object"&&(Object.hasOwnProperty.call(i,"height")&&(r.height=""+i.height),Object.hasOwnProperty.call(i,"width")&&(r.width=""+i.width)),r.height||(r.height="300"),r.width||r.setAttribute("style","width:100%;")}(t,n),e.parentNode.replaceChild(t,e)}function w(e){if(typeof e=="string"){var t=document.getElementById(e);if(!t)throw new Error("Could not find element with id '"+e+"'");return t}if(e instanceof HTMLElement)return e;throw new Error("Invalid element: "+e)}function _(e){return e&&e.newWindow===!1?"_self":"_blank"}function m(){return m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},m.apply(this,arguments)}var D=function(){function e(n){this.port=void 0,this.pending={},this.port=n,this.port.onmessage=this.messageListener.bind(this)}var t=e.prototype;return t.request=function(n){var r=this,i=n.type,o=n.payload,a=T();return new Promise(function(c,s){r.pending[a]={resolve:c,reject:s},r.port.postMessage({type:i,payload:m({},o,{__reqid:a})})})},t.messageListener=function(n){var r;if(typeof((r=n.data.payload)==null?void 0:r.__reqid)=="string"){var i=n.data,o=i.type,a=i.payload,c=a.__reqid,s=a.__error;this.pending[c]&&(a.__success?this.pending[c].resolve(function(d){var u=m({},d);return delete u.__reqid,delete u.__success,delete u.__error,Object.keys(u).length?u:null}(a)):this.pending[c].reject(s?o+": "+s:o),delete this.pending[c])}},e}(),q=function(){function e(n,r){var i=this;this._rdc=void 0,this.editor={openFile:function(o){return i._rdc.request({type:"SDK_OPEN_FILE",payload:{path:o}})},setCurrentFile:function(o){return i._rdc.request({type:"SDK_SET_CURRENT_FILE",payload:{path:o}})},setTheme:function(o){return i._rdc.request({type:"SDK_SET_UI_THEME",payload:{theme:o}})},setView:function(o){return i._rdc.request({type:"SDK_SET_UI_VIEW",payload:{view:o}})},showSidebar:function(o){return o===void 0&&(o=!0),i._rdc.request({type:"SDK_TOGGLE_SIDEBAR",payload:{visible:o}})}},this.preview={origin:"",getUrl:function(){return i._rdc.request({type:"SDK_GET_PREVIEW_URL",payload:{}}).then(function(o){var a;return(a=o?.url)!=null?a:null})},setUrl:function(o){if(o===void 0&&(o="/"),typeof o!="string"||!o.startsWith("/"))throw new Error("Invalid argument: expected a path starting with '/', got '"+o+"'");return i._rdc.request({type:"SDK_SET_PREVIEW_URL",payload:{path:o}})}},this._rdc=new D(n),Object.defineProperty(this.preview,"origin",{value:typeof r.previewOrigin=="string"?r.previewOrigin:null,writable:!1})}var t=e.prototype;return t.applyFsDiff=function(n){var r=function(i){return i!==null&&typeof i=="object"};if(!r(n)||!r(n.create))throw new Error("Invalid diff object: expected diff.create to be an object.");if(!Array.isArray(n.destroy))throw new Error("Invalid diff object: expected diff.create to be an array.");return this._rdc.request({type:"SDK_APPLY_FS_DIFF",payload:n})},t.getDependencies=function(){return this._rdc.request({type:"SDK_GET_DEPS_SNAPSHOT",payload:{}})},t.getFsSnapshot=function(){return this._rdc.request({type:"SDK_GET_FS_SNAPSHOT",payload:{}})},e}(),h=[],C=function(e){var t=this;this.element=void 0,this.id=void 0,this.pending=void 0,this.vm=void 0,this.id=T(),this.element=e,this.pending=new Promise(function(n,r){var i=function(d){var u=d.data;u?.action==="SDK_INIT_SUCCESS"&&u.id===t.id&&(t.vm=new q(d.ports[0],u.payload),n(t.vm),a())},o=function(){var d;(d=t.element.contentWindow)==null||d.postMessage({action:"SDK_INIT",id:t.id},"*")};function a(){window.clearInterval(s),window.removeEventListener("message",i)}window.addEventListener("message",i),o();var c=0,s=window.setInterval(function(){if(t.vm)a();else{if(c>=20)return a(),r("Timeout: Unable to establish a connection with the StackBlitz VM"),void h.forEach(function(d,u){d.id===t.id&&h.splice(u,1)});c++,o()}},500)}),h.push(this)};function l(e,t){var n=document.createElement("input");return n.type="hidden",n.name=e,n.value=t,n}function I(e){if(!b.includes(e.template)){var t=b.map(function(i){return"'"+i+"'"}).join(", ");console.warn("Unsupported project.template: must be one of "+t)}var n=e.template==="node",r=document.createElement("form");return r.method="POST",r.setAttribute("style","display:none!important;"),r.appendChild(l("project[title]",e.title)),r.appendChild(l("project[description]",e.description)),r.appendChild(l("project[template]",e.template)),e.dependencies&&(n?console.warn("Invalid project.dependencies: dependencies must be provided as a 'package.json' file when using the 'node' template."):r.appendChild(l("project[dependencies]",JSON.stringify(e.dependencies)))),e.settings&&r.appendChild(l("project[settings]",JSON.stringify(e.settings))),Object.keys(e.files).forEach(function(i){typeof e.files[i]=="string"&&r.appendChild(l("project[files]["+i+"]",e.files[i]))}),r}function f(e){var t,n,r,i;return e!=null&&e.contentWindow?(i=(n=e)instanceof Element?"element":"id",(t=(r=h.find(function(o){return o[i]===n}))!=null?r:null)!=null?t:new C(e)).pending:Promise.reject("Provided element is not an iframe.")}var L={connect:f,embedGithubProject:function(e,t,n){var r=w(e),i=document.createElement("iframe");return i.src=y("/github/"+t,n),g(r,i,n),f(i)},embedProject:function(e,t,n){var r,i=w(e),o=function(c,s){var d=I(c);return d.action=y("/run",s),d.id="sb","<html><head><title></title></head><body>"+d.outerHTML+"<script>document.getElementById('"+d.id+"').submit();<\/script></body></html>"}(t,n),a=document.createElement("iframe");return g(i,a,n),(r=a.contentDocument)==null||r.write(o),f(a)},embedProjectId:function(e,t,n){var r=w(e),i=document.createElement("iframe");return i.src=y("/edit/"+t,n),g(r,i,n),f(i)},openGithubProject:function(e,t){var n=v("/github/"+e,t),r=_(t);window.open(n,r)},openProject:function(e,t){(function(n,r){var i=I(n);i.action=v("/run",r),i.target=_(r),document.body.appendChild(i),i.submit(),document.body.removeChild(i)})(e,t)},openProjectId:function(e,t){var n=v("/edit/"+e,t),r=_(t);window.open(n,r)}};export{L as a};
